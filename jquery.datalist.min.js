(function(k,a,j){var d=k.document,f=!!("data" in d.createElement("datalist"))&&!!k.HTMLDataListElement&&!!("list" in d.createElement("input")),i=Array.prototype.some||function(m){var p;for(var n=0,o=this.length;n<o;n++){if((p=m(this[n],n,this))){return p}}return false},e=Array.prototype.filter||function(m){var q=[];for(var n=0,o=this.length,p;n<o;n++){if(m(p=this[n],n,this)){q.push(p)}}return q};function b(m){return parseInt(m,10)||0}function l(){return Math.max.apply(j,a("*").map(function(){return b(a(this).css("z-index"))}).get())}function c(m,p,o){var n=[];o.each(function(q){var t=a(this),u=t.attr("value")||t.text(),r=t.attr("label")||t.text(),s;n.push(s=a('<li style="padding: 2px; white-space: nowrap">').append('<span class="value">'+u+"</span>").append(a("<span>",{css:{opacity:0.8,"font-style":"italic","float":"right",display:r===u?"none":"inline"}}).text(r)).attr("title",r||u||"").appendTo(p)[0]);s.dataText=(r+" "+u).toLowerCase()});return n}function h(m,o,n){var r=m.val().toLowerCase(),q=n.matches||(n.matches=o),p=r.length>0&&r.indexOf(n.last)===0?q:o;if(n.last===r){return}n.last=r;n.matches=e.call(p,function(s){if(r.length===0||s.dataText.indexOf(r)>-1){s.style.display="block";return true}s.style.display="none"})}function g(n,p,m){var o=p.position(),q=l();m=m||"tl";n.css({top:o.top+(m.indexOf("b")>-1?p.outerHeight():-1)+b(p.css("margin-top")),left:o.left+(m.indexOf("r")>-1?p.outerWidth():0)+b(p.css("margin-left")),"z-index":Math.max(q,0)+100})}a.fn.datalist=function(m){m=a.extend({},{native_support:f,url:"",width:0},m);return m.native_support?this:this.each(function(){var n=a(this),q,t,o=a(d.getElementById(n.attr("list"))),r=o.find("option"),v=n.outerWidth()-2,p=n.height(),u=a("<ul>",{css:{width:m.width||v,position:n.css("position")==="fixed"?"fixed":"absolute",margin:0,padding:0,"list-style":"none",border:"1px solid #ccc","-moz-box-shadow":"0px 2px 3px #ccc","-webkit-box-shadow":"0px 2px 3px #ccc","box-shadow":"0px 2px 3px #ccc",cursor:"default","background-color":"Menu",color:"MenuText","max-height":130,overflow:"auto","font-size":n.css("font-size"),"font-family":n.css("font-family"),"line-height":n.css("line-height"),"font-weight":"normal"}});n.removeAttr("list").attr("autocomplete","off");if(!o.length&&!m.url){return}if(m.url||o.attr("data")){a.get(m.url||o.attr("data")).success(function(w){q=c(n,u,a(w).find("option"))})}else{q=c(n,u,r)}u.hide().insertAfter(n);var s={last:""};n.bind("start-hide",function(){n.trigger("cancel-hide");t=setTimeout(function(){n.trigger("hide-now")},300)}).bind("cancel-hide",function(){clearTimeout(t)}).bind("hide-now",function(w){u.hide();if(w.refocus){n.trigger({type:"focus",noshow:true})}}).bind("focus show-now",function(w){if(w.noshow){return}n.trigger("cancel-hide");g(u,n,"bl");if(w.type==="focus"){n.trigger("search")}u.show()}).blur(function(){n.trigger("start-hide")}).bind("keyup search",function(w){if(w.keyCode&&a.inArray(w.keyCode,[27,10,13,38,40,9])>-1){return}if(!u.is(":visible")){n.trigger("show-now")}clearTimeout(s.tmr);s.tmr=setTimeout(function(){h(n,q,s)},200)}).keydown(function(w){if(w.keyCode<=40){var z=u.find("li.selected:visible");if(w.keyCode==38){w.preventDefault();if(!u.is(":visible")){n.trigger("show-now")}if(z.length){z=z.trigger("mouseleave").prev(":visible")}}else{if(w.keyCode===40){w.preventDefault();if(!u.is(":visible")){n.trigger("show-now")}if(z.length){z=z.trigger("mouseleave").next(":visible")}else{z=u.find("li:visible:first").trigger("mouseenter")}}else{if(w.keyCode===27&&u.is(":visible")){w.preventDefault();n.trigger({type:"hide-now",refocus:true})}else{if(w.keyCode===13||w.keyCode===9&&u.is(":visible")){w.preventDefault();z.trigger("click")}}}}if(z.length){var A=z[0].offsetTop,y=u.scrollTop(),B=u.height(),x=z.height();if(y+B<A+x*2.5){u.stop().animate({scrollTop:A-B+x*2.5},50)}else{if(y>A){u.stop().animate({scrollTop:A-x},50)}}z.trigger("mouseenter")}}});u.delegate("li","click",function(){var w=a(this).find("span.value").text();n.val(w).trigger({type:"hide-now",refocus:true})}).delegate("li","mouseenter",function(){u.find(".selected").removeClass("selected");a(this).css({"background-color":"Highlight",color:"HighlightText"}).addClass("selected")}).delegate("li","mouseleave",function(){a(this).css({"background-color":"Menu",color:"MenuText"}).removeClass("selected")}).bind("scroll",function(){n.triggerHandler("focus")})})};a(function(){a("[list]").datalist()})})(window,jQuery);